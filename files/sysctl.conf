## -----------------------------------------------
## OTIMIZAÇÕES DE REDE E SISTEMA - PERFIL INTERMEDIÁRIO
## -----------------------------------------------

# --- TCP/IP ---

# Limite de conexões órfãs (seguro para conexões ocasionais intensas)
net.ipv4.tcp_max_orphans = 32768

# Aumentar backlog de conexões (útil para servidores locais)
net.core.somaxconn = 4096
net.ipv4.tcp_max_syn_backlog = 8192

# Aumentar fila de pacotes da interface (melhora performance sob carga de rede)
net.core.netdev_max_backlog = 8192

# Buffers de socket (recepção e envio)
net.core.rmem_max = 8388608        # 8 MB
net.core.wmem_max = 8388608        # 8 MB
net.ipv4.tcp_rmem = 4096 262144 8388608
net.ipv4.tcp_wmem = 4096 262144 8388608

# Range de portas locais (permite mais conexões simultâneas)
net.ipv4.ip_local_port_range = 10240 65535

# Reutilizar conexões TIME_WAIT (seguro em ambientes controlados)
net.ipv4.tcp_tw_reuse = 1

# Evita "slow start" depois de períodos ociosos
net.ipv4.tcp_slow_start_after_idle = 0

# Timeout razoável para conexões encerradas
net.ipv4.tcp_fin_timeout = 15

# Tentativas menores de retry para conexões falhas
net.ipv4.tcp_synack_retries = 2
net.ipv4.tcp_syn_retries = 2


# --- MEMÓRIA / SWAP ---

# Diminui uso de swap (mantém sistema mais responsivo)
vm.swappiness = 10

# Controla flush de páginas "sujas" para o disco
vm.dirty_ratio = 10
vm.dirty_background_ratio = 5


# --- SISTEMA DE ARQUIVOS ---

# Máximo de arquivos abertos (bom para Docker, VS Code, IDEs)
fs.file-max = 1048576


# --- TCP MEMÓRIA GLOBAL (mantém limites razoáveis sem sobrecarregar RAM) ---
# Valores: min pressure max — em páginas de 4 KB
# 524288 * 4 KB = 2 GB
net.ipv4.tcp_mem = 524288 786432 1048576
